name: Tienda APK Autom치tica
on:
  workflow_dispatch: # Bot칩n manual
  schedule:
    - cron: '*/30 * * * *' # 춰AUTOM츼TICO CADA 30 MINUTOS!

permissions:
  contents: write # Permiso para guardar el repo.json

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Instalar herramientas
        run: |
          sudo apt-get update
          sudo apt-get install -y aapt

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Instalar librer칤as
        run: pip install -r requirements.txt
        
      - name: 1. Procesar APKs (Drive -> Telegram)
        env:
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
          GOOGLE_SERVICE_ACCOUNT_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        run: python main.py

      - name: 2. Generar Cat치logo (Excel -> JSON)
        env:
          GOOGLE_SERVICE_ACCOUNT_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        run: python generar_json.py

      - name: 3. Publicar cambios (Guardar repo.json)
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "游댃 Actualizar cat치logo (Auto)"
          file_pattern: repo.json
